

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Events &mdash; FastSTI 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Extending FastSTI" href="extending.html" />
    <link rel="prev" title="Configuration file parameters" href="parameters.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> FastSTI
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing that it works</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstart.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputformats.html">Input file formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputformats.html">Output file formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Configuration file parameters</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending FastSTI</a></li>
<li class="toctree-l1"><a class="reference internal" href="improve.html">Help improve FastSTI</a></li>
<li class="toctree-l1"><a class="reference internal" href="improve.html#bugs-and-other-issues">Bugs and other issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">FastSTI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Events</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/events.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="events">
<span id="event-ref"></span><h1>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">_read_agents</p>
<p>Reads in a csv file of agents at the beginning of a simulation. The first
time it is executed, it saves the agents in memory so that on subsequent
simulations, it doesn’t have to process the file again.</p>
<p>If you don’t have a file of agents to read in, consider using the
_generate_agents event.</p>
<p>Datasets: None</p>
</li>
<li><p class="first">_generate_agents</p>
<p>Generates agents for a simulation instead of reading them from a file.</p>
<p>It uses the num_agents parameter to determine the number of agents to
generate.</p>
<p>The default implementation sets the following agent properties: age, sex,
sex_preferred, infected, treated and resistant.</p>
<ul class="simple">
<li>age is set via a random beta distribution determined by the parameters
age_alpha and age_beta.</li>
<li>sex is set via the dataset dataset_gen_sex. (See data/dataset_gen_sex.csv
for an example.)</li>
<li>sex_preferred is set via the dataset dataset_gen_sex_preferred. (See
data/dataset_gen_sex_preferred.csv for an example, which sets the agents to
prefer the opposite sex with a probability of 95%, but you can change this
according to the needs of your model.)</li>
<li>infected (i.e. the infection stage of the agent with 0 by convention meaning
the agent isn’t infected) is set via the dataset dataset_gen_infect. (See
data/dataset_gen_infect.csv for an example.)</li>
<li>treated (i.e. which treatment line, if any, the agent is on) is set via the
dataset dataset_gen_treated. (See data/dataset_gen_treated.csv for an
example.)</li>
<li>resistant (i.e. which treatment regimens the agent is resistant to, if
any. (See data/dataset_gen_resistant.csv for an example.)</li>
</ul>
<p>If you wish to set additional agent properties, you must provide hook in
by defining a macro called FSTI_HOOK_GENERATE_AGENT in fsti-userdefs.h. The
macro takes two parameters: simulation (a pointer to the current simulation)
and agent (a pointer to the current agent whose property you wish to set).</p>
</li>
<li><p class="first">_age</p>
<p>Iterates through all the living agents, and adds the time increment of the
simulation to their age.</p>
<p>This is one of the simplest events provided by FastSTI, and so it makes a nice
example of how events are implemented. Here is the source code:</p>
<div class="highlight-C notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kt">void</span>
<span class="nf">fsti_event_age</span><span class="p">(</span><span class="k">struct</span> <span class="n">fsti_simulation</span> <span class="o">*</span><span class="n">simulation</span><span class="p">)</span>
<span class="p">{</span>
   <span class="k">struct</span> <span class="n">fsti_agent</span> <span class="o">*</span><span class="n">agent</span><span class="p">;</span>
   <span class="n">FSTI_FOR_LIVING</span><span class="p">(</span><span class="o">*</span><span class="n">simulation</span><span class="p">,</span> <span class="n">agent</span><span class="p">,</span> <span class="p">{</span>
      <span class="n">agent</span><span class="o">-&gt;</span><span class="n">age</span> <span class="o">+=</span> <span class="n">simulation</span><span class="o">-&gt;</span><span class="n">time_step</span><span class="p">;</span>
   <span class="p">});</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>All events are declared like this, i.e. a void function that takes one
parameter: a pointer to the simulation itself.</p>
<p>On line 4 we declare a pointer to an agent on line three. When we iterate
through the living agents, this will be a pointer to the current agent the
code acts upon.</p>
<p>The FSTI_FOR_LIVING macro implements a for loop over the living agents.
The code inside the macro’s curly brackets simply adds the time step to each
agent’s age.</p>
<p>Datasets: None</p>
</li>
<li><p class="first">_death</p>
<p>Iterates through the living agents and kills some of them.</p>
<p>Datasets: dataset_mortality</p>
<p>Here is a simple example of this dataset:</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   infected;0
   0;0.00000296
   1;0.00000315
   2;0.00000315
   3;0.00000630
   4;0.001
</pre></div>
</td></tr></table></div>
<p>The first column tells the event to determine the infection stage of the
agent. The second column is the probability of the agent dying on this time
step. Here the probabilities are specified per day. If you change the time
step to, say, a week you have to update the probabilities in this file
accordingly.</p>
</li>
</ul>
<p>TO DO FROM HERE</p>
<p>_initial_mating</p>
<p>_initial_rel</p>
<p>_mating_pool</p>
<p>_breakup</p>
<p>_shuffle_living</p>
<p>_shuffle_mating</p>
<p>_rkpm</p>
<p>_breakup_and_pair</p>
<p>_generate_and_pair</p>
<p>_infect</p>
<p>_stage</p>
<p>_coinfect</p>
<p>_birth</p>
<p>_report</p>
<p>_write_results_csv_header,</p>
<p>_write_agents_csv_header</p>
<p>_write_partnerships_csv_header</p>
<p>_write_agents_csv</p>
<p>_write_living_agents_csv</p>
<p>_write_dead_agents_csv</p>
<p>_write_agents_pretty</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="extending.html" class="btn btn-neutral float-right" title="Extending FastSTI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="parameters.html" class="btn btn-neutral float-left" title="Configuration file parameters" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Nathan Geffen and Stefan Scholz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>