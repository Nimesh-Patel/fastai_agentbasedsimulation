

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Interesting example &mdash; FastSTI 0.2.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Input file formats" href="inputformats.html" />
    <link rel="prev" title="Tutorial: Creating simulations" href="guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> FastSTI
          

          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="getstart.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="guide.html">Tutorial: Creating simulations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Interesting example</a></li>
<li class="toctree-l1"><a class="reference internal" href="inputformats.html">Input file formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="outputformats.html">Output file formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Configuration file parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">Extending FastSTI</a></li>
<li class="toctree-l1"><a class="reference internal" href="improve.html">Help improve FastSTI</a></li>
<li class="toctree-l1"><a class="reference internal" href="improve.html#bugs-and-other-issues">Bugs and other issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="refs.html">References</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="credits.html">Credits</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">FastSTI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Interesting example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/example.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="interesting-example">
<h1>Interesting example<a class="headerlink" href="#interesting-example" title="Permalink to this headline">¶</a></h1>
<p>Here is an experiment that we hope demonstrates the versatility of FastSTI.</p>
<p>It shows some interesting and counter-intuitive results, as well as how to use
FastSTI in conjunction with a scripting language like R.</p>
<p>Here is the input configuration, which you can also find in simulations/examples/experiment.ini:</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   <span class="k">[Simulation Group 0]</span>

   <span class="na">threads</span><span class="o">=</span><span class="s">0</span>
<span class="s">   match_k = 1</span>
<span class="s">   num_simulations=30</span>
<span class="s">   num_agents=10000</span>
<span class="s">   time_step=1 DAY</span>
<span class="s">   simulation_period=10 YEARS</span>
<span class="s">   report_frequency=100</span>

   <span class="na">before_events</span><span class="o">=</span><span class="s">_write_results_csv_header;_generate_and_pair;_report</span>
<span class="s">   during_events=_age;_breakup_and_pair;_infect;_stage;_birth;_death;_report</span>
<span class="s">   after_events=_report</span>

   <span class="na">dataset_gen_sex</span><span class="o">=</span><span class="s">dataset_gen_sex.csv</span>
<span class="s">   dataset_gen_sex_preferred=dataset_gen_sex_preferred.csv</span>
<span class="s">   dataset_gen_infect=dataset_gen_infect.csv</span>
<span class="s">   dataset_gen_treated=dataset_gen_treated.csv</span>
<span class="s">   dataset_gen_resistant=dataset_gen_resistant.csv</span>
<span class="s">   dataset_gen_mating=dataset_gen_mating.csv</span>

   <span class="na">dataset_birth_infect</span><span class="o">=</span><span class="s">dataset_gen_infect.csv</span>
<span class="s">   dataset_birth_treated=dataset_birth_treated.csv</span>
<span class="s">   dataset_birth_resistant=dataset_birth_resistant.csv</span>

   <span class="na">dataset_rel_period</span><span class="o">=</span><span class="s">dataset_rel.csv</span>
<span class="s">   dataset_single_period=dataset_single.csv</span>
<span class="s">   dataset_infect=dataset_infect.csv</span>
<span class="s">   dataset_infect_stage=dataset_infect_stage.csv</span>
<span class="s">   dataset_mortality=dataset_mortality_simple.csv</span>

   <span class="na">results_file</span><span class="o">=</span><span class="s">results.csv</span>

   <span class="k">[Simulation Group 1]</span>
   <span class="na">match_k</span> <span class="o">=</span> <span class="s">100</span>

   <span class="k">[Simulation Group 2]</span>
   <span class="na">match_k</span> <span class="o">=</span> <span class="s">1</span>
<span class="s">   num_agents=100000</span>

   <span class="k">[Simulation Group 3]</span>
   <span class="na">match_k</span> <span class="o">=</span> <span class="s">100</span>
</pre></div>
</td></tr></table></div>
<p>It tells FastSTI to run four groups of simulations. Each group runs 30 simulations.</p>
<p>All groups run daily for ten years starting on 1 January 2018. For each
simulation statistics are printed every 100 days, and then at the end, 1 January
2028. (The dates don’t matter, by the way.)</p>
<ul class="simple">
<li>The first group (group 0) is 10,000 agents with random matching.</li>
<li>The second group is 10,000 agents with k-nearest neighbour matching (using
FastSTI’s _rkpm event) xwith k=100.</li>
<li>The third group is 100,000 agents with random matching.</li>
<li>The fourth group is 100,000 agents with k-nearest neighbour matching with
k=100.</li>
</ul>
<p>The results are written to a file called results.csv. The file is large so we’ve
<a class="reference external" href="_static/results.tgz">compressed</a> it.  On a mid-range laptop with an i5 with
four cores and 12GB of RAM it took just over 16 minutes to run the 120
simulations.</p>
<p>We then ran results.csv through this R script, which you can find in
scripts/processResultsFile.R. (The equivalent Python script is in scripts/processResultsFile.py.)</p>
<div class="highlight-R notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   <span class="c1"># Takes a results CSV file produced by FastSTI and runs a function</span>
   <span class="c1"># (default mean) over a statistic (description) grouping the result</span>
   <span class="c1"># either by the maximum date or all the dates.</span>

   <span class="n">processFastSTIResults</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s">&quot;results.csv&quot;</span><span class="p">,</span>
                                     <span class="n">sep</span><span class="o">=</span><span class="s">&quot;;&quot;</span><span class="p">,</span>
                                     <span class="n">description</span><span class="o">=</span><span class="s">&quot;INFECT_RATE_ALIVE&quot;</span><span class="p">,</span>
                                     <span class="n">fun</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                                     <span class="n">header</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span>
                                     <span class="n">filter_max_date</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span> <span class="p">{</span>
       <span class="n">inp</span> <span class="o">=</span> <span class="nf">read.csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="n">sep</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">)</span>
       <span class="n">values</span> <span class="o">=</span> <span class="n">inp[inp</span><span class="o">$</span><span class="n">description</span><span class="o">==</span><span class="n">description</span><span class="p">,</span><span class="n">]</span>
       <span class="nf">if </span><span class="p">(</span><span class="n">filter_max_date</span><span class="p">)</span> <span class="p">{</span>
           <span class="n">analysisDate</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="nf">as.Date</span><span class="p">(</span><span class="n">values</span><span class="o">$</span><span class="n">date</span><span class="p">))</span>
           <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="nf">[as.Date</span><span class="p">(</span><span class="n">values</span><span class="o">$</span><span class="n">date</span><span class="p">)</span><span class="o">==</span><span class="n">analysisDate</span><span class="p">,</span><span class="n">]</span>
       <span class="p">}</span>
       <span class="n">mean_values</span> <span class="o">=</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">values</span><span class="o">$</span><span class="n">value</span><span class="p">,</span>
                               <span class="n">by</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">values</span><span class="o">$</span><span class="n">name</span><span class="p">,</span>
                                       <span class="n">values</span><span class="o">$</span><span class="n">date</span><span class="p">),</span>
                               <span class="n">FUN</span><span class="o">=</span><span class="n">fun</span><span class="p">)</span>
   <span class="p">}</span>

   <span class="nf">print</span><span class="p">(</span><span class="nf">processFastSTIResults</span><span class="p">())</span>
</pre></div>
</td></tr></table></div>
<p>This is the output:</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   Simulation Group 0        2028-01-01      0.4280027667
   Simulation Group 1        2028-01-01      0.3647885667
   Simulation Group 2        2028-01-01      0.4283530667
   Simulation Group 3        2028-01-01      0.2342883667
</pre></div>
</td></tr></table></div>
<p>What do the results tell us?</p>
<ol class="arabic simple">
<li>Random matching results in much higher infection rates than “intelligent”
matching algorithms that try to pair agents using realistic criteria. This is
expected. With random matching, one would expect an infection to spread quite
rapidly through a population. With more realistic matching, we expect more
sexual networks to form and the infection only occasionally moves from one
network to another.</li>
<li>Random matching gives the same results irrespective of the number of agents
(42.8%). This too is expected.</li>
<li>With “intelligent” matching prevalence decreases as the population increases
(a mean of 36.5% for the 10,000 agent simulations after ten years vs 23.4%
for the 100,000 agent simulations). This is not intuitive, at least not to
us, though we have hypotheses for why it happens. We leave it to you to
speculate further.</li>
</ol>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="inputformats.html" class="btn btn-neutral float-right" title="Input file formats" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="guide.html" class="btn btn-neutral float-left" title="Tutorial: Creating simulations" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Nathan Geffen and Stefan Scholz

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>