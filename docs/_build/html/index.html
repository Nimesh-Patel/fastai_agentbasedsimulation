
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>FastSTI: Simulations of sexually transmitted infections &#8212; FastSTI 0.1.0 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="#">FastSTI 0.1.0 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="faststi-simulations-of-sexually-transmitted-infections">
<h1>FastSTI: Simulations of sexually transmitted infections<a class="headerlink" href="#faststi-simulations-of-sexually-transmitted-infections" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>FastSTI is a framework for agent-based models of large simulations of sexually
transmitted infection epidemics. It is designed to handle up to tens of millions of
agents on standard consumer hardware, like your laptop or, or a high performance
computer.</p>
<p>It runs simulations in parallel. The output of the simulations is written to CSV
files, which can be further processed in scripting languages like Python
or R.</p>
<p>You can do sophisticated simulations without making any modifications to the
code. But if you do wish to extend the framework, it is written in C. The
framework has been designed with extensibility in mind. The code adheres
strictly to the C11 standard and should compile on any good modern C compiler.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gnu-linux">
<h3>GNU/Linux<a class="headerlink" href="#gnu-linux" title="Permalink to this headline">¶</a></h3>
<p>Carry out these steps to install FastSTI on a GNU/Linux PC that uses apt
(e.g. Ubuntu).</p>
<p>Install the dependencies:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="n">git</span> <span class="n">build</span><span class="o">-</span><span class="n">essential</span> <span class="n">meson</span> <span class="n">valgrind</span> <span class="n">libgsl</span><span class="o">-</span><span class="n">dev</span> <span class="n">libglib2</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>Installing the framework is quick and easy.</p>
<p>Create a folder for the installation and cd into it. E.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">mysim</span><span class="p">;</span> <span class="n">cd</span> <span class="n">mysim</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">nathangeffen</span><span class="o">/</span><span class="n">faststi</span> <span class="o">.</span>
</pre></div>
</div>
<p>Installations are cheap and easy. Install as often as you like and, if an
installation is no longer needed, simply remove its folder with “rm -f”.</p>
</div>
<div class="section" id="apple-macos">
<h3>Apple macOS<a class="headerlink" href="#apple-macos" title="Permalink to this headline">¶</a></h3>
<p>Compiling on macOS is easy. You can use either Apples clang/LLVM compiler or the
GNU C compiler.</p>
<p>Install and configure the dependencies with <a class="reference external" href="https://brew.sh/">Homebrew</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="p">(</span><span class="n">If</span> <span class="n">you</span> <span class="n">don</span><span class="s1">&#39;t have Homebrew installed): ::</span>
</pre></div>
</div>
<blockquote>
<div>/usr/bin/ruby -e “$(curl -fsSL  <a class="reference external" href="https://raw.githubusercontent.com/Homebrew/install/master/install">https://raw.githubusercontent.com/Homebrew/install/master/install</a>)”
brew install gcc pkg-config glib gsl meson ninja</div></blockquote>
<ul>
<li><p class="first">Create a folder for the installation and cd into it. E.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">mysim</span><span class="p">;</span> <span class="n">cd</span> <span class="n">mysim</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">nathangeffen</span><span class="o">/</span><span class="n">faststi</span> <span class="o">.</span>
</pre></div>
</div>
</li>
</ul>
<p>Installations are cheap and easy. Install as often as you like and, if an
installation is no longer needed, simply remove its folder with “rm -f”.</p>
</div>
<div class="section" id="windows">
<h3>Windows<a class="headerlink" href="#windows" title="Permalink to this headline">¶</a></h3>
<p>We haven’t developed or tested FastSTI on Windows, but it should work,
especially if you use the MinGW suite. Feedback (via the <a class="reference external" href="https://github.com/faststi">Github repository</a>) on
running it under Windows is welcome.</p>
</div>
</div>
<div class="section" id="testing-that-it-works">
<h2>Testing that it works<a class="headerlink" href="#testing-that-it-works" title="Permalink to this headline">¶</a></h2>
<p>If you use gcc as your C compiler, then simply do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">meson</span> <span class="n">debug</span>
<span class="n">cd</span> <span class="n">debug</span><span class="p">;</span> <span class="n">ninja</span>
<span class="n">FSTI_DATA</span><span class="o">=../</span><span class="n">data</span> <span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">faststi</span> <span class="o">-</span><span class="n">t</span>
</pre></div>
</div>
<p>This will run the test suite. If everything is properly installed no failures
should be reported.</p>
<p>You’ve created an unoptimised version of the faststi executable, useful for
debugging and development. To create an optimised version for running big,
CPU-intensive simulations, do this from the root directory of your simulation
(<em>mysim</em> in the above example):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">meson</span> <span class="o">--</span><span class="n">buildtype</span> <span class="n">release</span> <span class="n">release</span>
</pre></div>
</div>
<p>To test that it’s working:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">release</span>
<span class="n">FSTI_DATA</span><span class="o">=../</span><span class="n">data</span> <span class="o">./</span><span class="n">src</span><span class="o">/</span><span class="n">faststi</span> <span class="o">-</span><span class="n">t</span>
</pre></div>
</div>
<p>Alternately you can use the <em>fsti</em> script in your installation directory. Assuming
you called it <em>mysim</em>, change into the <em>mysim</em> directory, and run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">fsti</span> <span class="o">-</span><span class="n">t</span>
</pre></div>
</div>
<p>The above will create the debug directory, compile FastSTI, and run the test
suite. To instead run the release version:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">fsti</span> <span class="n">release</span> <span class="o">-</span><span class="n">t</span>
</pre></div>
</div>
<p>Again, no errors should be reported.</p>
<p>If you have <a class="reference external" href="https://valgrind.org">valgrind</a> on your system (an excellent tool
for finding memory and other problems in C programs), you can do this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">debug</span>
<span class="n">ninja</span> <span class="n">test</span>
</pre></div>
</div>
</div>
<div class="section" id="how-to-use-faststi">
<h2>How to use FastSTI<a class="headerlink" href="#how-to-use-faststi" title="Permalink to this headline">¶</a></h2>
<p>FastSTI takes as input a configuration file which tells it how many simulations
to run, and how to run each simulation. It also takes data as input in files
that we call datasets. And optionally, it takes a file of agents, though the
agents can be generated by FastSTI itself, via instructions in the configuration file.</p>
<p>The outputs are a report of simulation results, and the agents.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/FastSTI-Overview.png"><img alt="Structure of FastSTI execution" src="_images/FastSTI-Overview.png" style="width: 280px;" /></a>
<p class="caption"><span class="caption-text">FastSTI inputs include a configuration file, datasets and agent files. The
outputs are an agent file and simulation results.</span></p>
</div>
<div class="section" id="simulations">
<h3>Simulations<a class="headerlink" href="#simulations" title="Permalink to this headline">¶</a></h3>
<p>A simulation continuously iterates over sets of agents, executing events on the
agents on each iteration (which we call a time step). The structure of a FastSTI
simulation is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Execute</span> <span class="n">events</span> <span class="n">before</span> <span class="n">simulation</span> <span class="n">runs</span>
<span class="k">for</span> <span class="n">each</span> <span class="n">time</span><span class="o">-</span><span class="n">step</span>
  <span class="k">for</span> <span class="n">each</span> <span class="n">event</span> <span class="n">E</span>
      <span class="k">for</span> <span class="n">each</span> <span class="n">agent</span> <span class="n">A</span>
          <span class="k">if</span> <span class="n">E</span> <span class="n">should</span> <span class="n">be</span> <span class="n">applied</span> <span class="n">to</span> <span class="n">A</span>
              <span class="n">apply</span> <span class="n">E</span> <span class="n">to</span> <span class="n">A</span>
<span class="n">Execute</span> <span class="n">events</span> <span class="n">after</span> <span class="n">simulation</span> <span class="n">runs</span>
</pre></div>
</div>
<p>The number of agents and the specific events to execute are specified in a
configuration file. FastSTI’s configuration file uses the <em>.ini</em> format, which
are the standard simple configuration format used on MS Windows and the GTK
framework popular on Linux systems.</p>
<p>You can configure the number of agents, the events and the order of events that
execute upon them, the size of the time step (default 1 day), the number of time
steps (default 10 years) and much else (see <a class="reference internal" href="#parameter-ref"><span class="std std-ref">Parameters</span></a>).</p>
<p>FastSTI has a number of useful built-in events useful for modelling STI
epidemics (see <a class="reference internal" href="#event-ref"><span class="std std-ref">Events</span></a>). These include agent ageing, death, matching
agents in sexual relationships, infection with the STI, disease advance,
co-infection, and breakups.</p>
<p>There are also useful supporting events that read in agent files or generate the
agents, write the agents to a CSV file, and write basic statistics to a CSV file.</p>
<p>If you need more events, the framework has been designed with extensibility in
mind. You can define new events in C, identify them to FastSTI, quickly
recompile the code and use them.</p>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>Let’s start off with the simplest simulation. Change into the
simulations/examples directory. Take a look at eg1.ini.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Faststi &quot;Hello world&quot; equivalent simulation</span>
<span class="p">[</span><span class="n">Simulation_0</span><span class="p">]</span>
<span class="n">after_events</span><span class="o">=</span><span class="n">_report</span>
</pre></div>
</div>
<p>The first line is a comment.</p>
<p>The second line is the name of the simulation group: <em>First simulation</em>. A
simulation group can have one or more simulations. This particular group has
only one simulation.</p>
<p>The third line is one of the dozens of parameters used to configure
simulations. The <em>after_events</em> parameter tells FastSTI what events to execute
when the simulation is finished. <em>_report</em> is a built-in event that prints out
basic information about the state of a simulation. All built-in events are
prefixed with an underscore, to differentiate them from ones you might code
yourself.</p>
<p>To run the simulation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../../</span><span class="n">fsti</span> <span class="o">-</span><span class="n">f</span> <span class="n">eg1</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>The output may look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">MIN_AGE_ALIVE</span><span class="p">;</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">MAX_AGE_ALIVE</span><span class="p">;</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">MEAN_AGE_ALIVE</span><span class="p">;</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">MEDIAN_AGE_ALIVE</span><span class="p">;</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">INFECT_RATE_ALIVE</span><span class="p">;</span><span class="o">-</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">POP_ALIVE</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">NUM_PARTNERS</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">MIN_AGE_DEAD</span><span class="p">;</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">MAX_AGE_DEAD</span><span class="p">;</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">MEAN_AGE_DEAD</span><span class="p">;</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">INFECT_RATE_DEAD</span><span class="p">;</span><span class="o">-</span><span class="n">nan</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">POP_DEAD</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">INITIAL_INFECTIONS</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">SIMULATION_INFECTIONS</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">INITIAL_MATCHES</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">SIMULATION_MATCHES</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">BREAKUPS</span><span class="p">;</span><span class="mi">0</span>
<span class="n">First</span> <span class="n">simulation</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">0</span><span class="p">;</span><span class="mi">2028</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span><span class="p">;</span><span class="n">TIME_TAKEN</span><span class="p">;</span><span class="mi">0</span>
</pre></div>
</div>
<p>Note that it’s in csv format, so you easily import it into Python or R and
process it. You can also redirect the output to a file instead of standard
output with the <em>results_file</em> parameter.</p>
<p>The fields of the csv file are: the name of the simulation, the number of the
current simulation, the number of the simulation within the current simulation
group, the date within the simulation for which the output applies, a
description field, and the value of the description field. E.g. the last two
columns of the last line are TIME_TAKEN and 0. This tells you that it took zero
seconds for the simulation to run. Likewise the POP_ALIVE and POP_DEAD entries
tell us that the population alive and dead in this simulation on 1 January 2028
is 0.</p>
<div class="section" id="a-full-simulation">
<h4>A full simulation<a class="headerlink" href="#a-full-simulation" title="Permalink to this headline">¶</a></h4>
<p>The output of the eg1.ini simulation is rather uninteresting. To get more
interesting output we need a more interesting simulation. Take a look at
eg2.ini.</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   <span class="c1"># First interesting simulation</span>

   <span class="k">[Full simulation]</span>

   <span class="na">num_simulations</span><span class="o">=</span><span class="s">4</span>
<span class="s">   num_agents=10000</span>
<span class="s">   time_step=1 DAY</span>
<span class="s">   simulation_period=10 YEARS</span>

   <span class="na">before_events</span><span class="o">=</span><span class="s">_write_agents_csv_header;_generate_and_pair;_report;_write_agents_csv</span>
<span class="s">   during_events=_age;_breakup_and_pair;_infect;_stage;_birth;_death</span>
<span class="s">   after_events=_write_agents_csv;_report</span>

   <span class="na">dataset_gen_sex</span><span class="o">=</span><span class="s">dataset_gen_sex.csv</span>
<span class="s">   dataset_gen_sex_preferred=dataset_gen_sex_preferred.csv</span>
<span class="s">   dataset_gen_infect=dataset_gen_infect.csv</span>
<span class="s">   dataset_gen_treated=dataset_gen_treated.csv</span>
<span class="s">   dataset_gen_resistant=dataset_gen_resistant.csv</span>
<span class="s">   dataset_gen_mating=dataset_gen_mating.csv</span>

   <span class="na">dataset_birth_infect</span><span class="o">=</span><span class="s">dataset_gen_infect.csv</span>
<span class="s">   dataset_birth_treated=dataset_birth_treated.csv</span>
<span class="s">   dataset_birth_resistant=dataset_birth_resistant.csv</span>

   <span class="na">dataset_rel_period</span><span class="o">=</span><span class="s">dataset_rel.csv</span>
<span class="s">   dataset_single_period=dataset_single.csv</span>
<span class="s">   dataset_infect=dataset_infect.csv</span>
<span class="s">   dataset_infect_stage=dataset_infect_stage.csv</span>
<span class="s">   dataset_mortality=dataset_mortality_simple.csv</span>


   <span class="na">agents_output_file</span><span class="o">=</span><span class="s">agents_out.csv</span>
<span class="s">   results_file=results.csv</span>

   <span class="na">threads</span><span class="o">=</span><span class="s">1</span>

   <span class="k">[Change time period]</span>

   <span class="na">threads</span><span class="o">=</span><span class="s">0 # As many threads as there are cores will execute</span>
<span class="s">   simulation_period=5 YEARS</span>
</pre></div>
</td></tr></table></div>
<p>Assuming you are in the simulations/examples directory you can run this
simulation as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">../../</span><span class="n">fsti</span> <span class="n">release</span> <span class="o">-</span><span class="n">f</span> <span class="n">eg2</span><span class="o">.</span><span class="n">ini</span>
</pre></div>
</div>
<p>The <em>release</em> command line parameter ensures the much faster <em>release</em> version
of FastSTI (without debugging code) executes. It will likely take about 10
seconds to run.</p>
<p>This is what the configuration does:</p>
<ul>
<li><p class="first">Line 1 is a comment. Comments start with a #.</p>
</li>
<li><p class="first">Line 3 specifies the name of the first group of simulations: <em>Full simulation</em></p>
</li>
<li><p class="first">Line 5 specifies the number of simulations to run in this group. Note that
parameter names, like <em>num_simulations</em>, are case-sensitive.</p>
</li>
<li><p class="first">Line 6 specifies the number of agents in the simulation.</p>
</li>
<li><p class="first">Line 7 specifies the time period represented by each simulation iteration, 1
day in this case. The format for this parameter and others like it that
specify a time period is a positive integer followed by either MINUTE, HOUR,
DAY, WEEK, MONTH or YEAR. You can also use the plural of any of these time
periods or any combination of lower and upper case (i.e. minute, minutes,
hour, hours, day, days, week, weeks, month, months or year, years). You can
also put a hyphen instead of a space between the integer and the time
period. If you leave out the time period, it’s assumed to be minutes. In
FastSTI, the predefined time period have the following number of minutes:</p>
<ul class="simple">
<li>hour: 60</li>
<li>day: 1440</li>
<li>week: 10,080</li>
<li>month: 43,830</li>
<li>year: 525949</li>
</ul>
</li>
<li><p class="first">Line 8 specifies the simulation period: 10 years in this case. The number of
time steps (or iterations) of the simulation is calculated by dividing the
simulation_period by the time_step. In this simulation there are therefore
3,652 iterations: <span class="math notranslate nohighlight">\(10 \times 525949 / 1440\)</span>.</p>
</li>
<li><p class="first">Line 10 lists the events that are to be run before each simulation
starts.</p>
<ul class="simple">
<li>The _write_agents_csv_header event simply writes the first line of the csv
file to which agents will be written.</li>
<li>The _generate_and_pair event generates agents (equal to the <em>num_agents</em>
parameter) and pairs a subset of them in sexual relationships.</li>
<li>The _report event prints out some simple statistics about the agent
population.</li>
<li>The _write_agents_csv event prints out the agents in csv format.</li>
</ul>
</li>
<li><p class="first">Line 11 lists the events that are run on every iteration of the simulation.</p>
<ul class="simple">
<li>The _age event increases the age of each agent by the <em>time_step</em> of the
simulation (one day in this example).</li>
<li>The _breakup_and_pair event pairs a subset of agents into sexual
partnerships and breaks up another subset of agents who are already in
sexual partnerships.</li>
<li>The _infect event infects a subset of agents in sexual partnerships with
other infected agents with the pathogen being studied, e.g. HIV.</li>
<li>The _stage event manages the infection progression of infected agents. For
example, agents with HIV will first be in an acute sero-conversion phase,
than a chronic infection stage, and then one or more stages that are
analogous to progression to AIDS.</li>
<li>The _birth and _death events create new agents and kill agents respectively.</li>
</ul>
<p>Many of these events depend on pre-specified parameters to calculate
probabilities of the events occurring and, perhaps, other outcomes. These data
are described in dataset files which are described in the
<a class="reference internal" href="#dataset-format"><span class="std std-ref">Datasets</span></a> section.</p>
</li>
<li><p class="first">Lines 14 to 29 list the names of the datasets associated with the various
events. For example the <em>dataset_mortality</em> parameter tells the simulation the
probability of an agent with a given set of characteristics dying.</p>
</li>
<li><p class="first">Line 32 tells the simulation to write agents out to a csv file called
<em>agents_out.csv</em>.</p>
</li>
<li><p class="first">Line 33 tells the simulation to write simple population level statistical
information produced by the <em>_report</em> event to a file called <em>results.csv</em>.</p>
</li>
<li><p class="first">Line 35 tells the simulation to run as a single thread. In other words each of
the four simulations (specified on line 5) will run consecutively.</p>
</li>
<li><p class="first">Line 37 specifies a new simulation group called <em>Change time period</em>.</p>
</li>
<li><p class="first">Line 39 tells FastSTI to run the simulations in parallel, using up to as many
threads as there are CPU cores in the machine. On a quad-core CPU, all four
simulations could run at the same time.</p>
</li>
<li><p class="first">Line 40 specifies a different simulation period (5 years) to the <em>Full simulation</em> set
of simulations. All other parameters set in the <em>Full simulation</em> set carry
through to this simulation set.</p>
</li>
</ul>
<p>There are more configuration examples in the simulation directory.</p>
</div>
</div>
</div>
<div class="section" id="input-file-formats">
<h2>Input file formats<a class="headerlink" href="#input-file-formats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="configuration">
<h3>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h3>
<p>The configuration file, which specifies the simulations, is in Windows ini
format. Here is an example:</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   <span class="c1"># Faststi test configuration file</span>

   <span class="k">[Simulation 0]</span>

   <span class="na">num_simulations</span><span class="o">=</span><span class="s">1</span>
<span class="s">   num_agents=10000</span>
<span class="s">   simulation_period=10 YEARS</span>

   <span class="na">agents_output_file</span><span class="o">=</span><span class="s">agents_out.csv</span>
<span class="s">   results_file=results.csv</span>

   <span class="na">dataset_gen_sex</span><span class="o">=</span><span class="s">dataset_gen_sex.csv</span>
<span class="s">   dataset_gen_sex_preferred=dataset_gen_sex_preferred.csv</span>
<span class="s">   dataset_gen_infect=dataset_gen_infect.csv</span>
<span class="s">   dataset_gen_treated=dataset_gen_treated.csv</span>
<span class="s">   dataset_gen_resistant=dataset_gen_resistant.csv</span>
<span class="s">   dataset_gen_mating=dataset_gen_mating.csv</span>

   <span class="na">dataset_birth_infect</span><span class="o">=</span><span class="s">dataset_gen_infect.csv</span>
<span class="s">   dataset_birth_treated=dataset_birth_treated.csv</span>
<span class="s">   dataset_birth_resistant=dataset_birth_resistant.csv</span>

   <span class="na">dataset_rel_period</span><span class="o">=</span><span class="s">dataset_rel.csv</span>
<span class="s">   dataset_single_period=dataset_single.csv</span>
<span class="s">   dataset_infect=dataset_infect.csv</span>
<span class="s">   dataset_infect_stage=dataset_infect_stage.csv</span>
<span class="s">   dataset_mortality=dataset_mortality_simple.csv</span>

   <span class="na">before_events</span><span class="o">=</span><span class="s">_write_agents_csv_header;_generate_and_pair;_report;_write_agents_csv</span>
<span class="s">   during_events=_age;_breakup_and_pair;_infect;_stage;_birth;_death</span>
<span class="s">   after_events=_write_agents_csv;_report</span>

   <span class="na">match_k</span><span class="o">=</span><span class="s">100</span>
<span class="s">   threads=1</span>

   <span class="k">[Simulation 1]</span>

   <span class="na">dataset_mortality</span><span class="o">=</span><span class="s">dataset_mortality_complicated.csv</span>
<span class="s">   match_k=300</span>
</pre></div>
</td></tr></table></div>
<ul>
<li><p class="first">Comment lines begin with a #.</p>
</li>
<li><p class="first">A # in the middle of a line also denotes a comment until the end of the line.</p>
</li>
<li><p class="first">A simulation group name is enclosed in square brackets <em>[]</em>.</p>
</li>
<li><p class="first">Within a simulation group, parameters are specified as key-vale pairs. A key is
separated from its value by an equals sign. White space before and after the =
sign is ignored.</p>
</li>
<li><p class="first">Some parameters (e.g. <em>during_events</em> take multiple values. Each value must be
separated by a semi-colon <em>;</em>. White space before or after the semi-colon is
ignored.</p>
</li>
<li><p class="first">Blank lines are ignored.</p>
</li>
<li><p class="first">Each key must be a predefined parameter. If you use a key that isn’t a
predefined parameter, the FastSTI will give an error message and terminate. To
see all the parameters, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">fsti</span> <span class="o">-</span><span class="n">p</span>
</pre></div>
</div>
</li>
<li><p class="first">Key-values set in a simulation group are carried through to subsequent groups,
unless they are specified again in the new group. E,g, in the example above,
<em>dataset_mortality</em> and <em>match_k</em> are specified again for the simulation group
called <em>Simulation 1</em>. All the other parameters are identical to <em>Simulation
0</em>.</p>
</li>
</ul>
</div>
<div class="section" id="datasets">
<span id="dataset-format"></span><h3>Datasets<a class="headerlink" href="#datasets" title="Permalink to this headline">¶</a></h3>
<p>Many events depend on datasets. The format of the dataset file is a little
cumbersome but it is designed for a combination of speed and safety.</p>
<p>Datasets can either be placed in the <em>data</em> directory, or in the directory in
which the simulation is being run. Alternately, the <em>FSTI_DATA</em> environment
variable can be set to the location where the datasets are located.</p>
<p>Datasets are csv files. The default delimiter is a semi-colon, not a comma. You
can change this by setting the csv_delimiter</p>
<p>A standard dataset consists of 0 or more columns representing the values of
agent properties, followed by 1 or more columns representing probabilities or
other derived values. Events typically match the properties of the current agent
being operated upon to the corresponding row in the dataset in order to obtain
the appropriate probability of the event occurring. Sometimes there</p>
<p>Let’s start with the very simplest of the supplied datasets. It is
<em>dataset_gen_sex.csv</em> and it is located in the <em>data</em> directory. It is used by
the <em>_generate_agents</em> event to initialize the sex of agents at the beginning of
simulations.  Here it is:</p>
<div class="highlight-ini notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   <span class="na">Probability</span>
   <span class="na">0.5</span>
</pre></div>
</td></tr></table></div>
<p>Line 1 is simply the CSV header. It is called <em>Probability</em> here but we could
have named it anything. Line 2 is 0.5, the odds of being male. The event
uses this to set approximately half the agents to male and half to female when
it generates agents.</p>
<p>Here’s a more typical dataset, <em>dataset_gen_infect.csv</em>, also used by the
<em>_generate_agents</em> event to determine the infection stage, if any, of agents
when they are initialized.</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   sex;sex_preferred;age|10-YEAR;1;2;3;4|4
   0;0;0;0;0;0;0
   0;0;1;0;0;0;0
   0;0;2;0.1;0.2;0.3;0.4
   0;0;3;0.1;0.2;0.3;0.4
   0;0;4;0.05;0.1;0.15;0.2
   0;0;5;0.025;0.05;0.075;0.1
   0;1;0;0;0;0;0
   0;1;1;0;0;0;0
   0;1;2;0.05;0.1;0.15;0.2
   0;1;3;0.05;0.1;0.15;0.2
   0;1;4;0.025;0.05;0.075;0.1
   0;1;5;0.0125;0.025;0.0375;0.05
   1;0;0;0;0;0;0
   1;0;1;0;0;0;0
   1;0;2;0.05;0.1;0.15;0.2
   1;0;3;0.05;0.1;0.15;0.2
   1;0;4;0.025;0.05;0.075;0.1
   1;0;5;0.0125;0.025;0.0375;0.05
   1;1;0;0;0;0;0
   1;1;1;0;0;0;0
   1;1;2;0.05;0.1;0.15;0.2
   1;1;3;0.05;0.1;0.15;0.2
   1;1;4;0.025;0.05;0.075;0.1
   1;1;5;0.0125;0.025;0.0375;0.05
</pre></div>
</td></tr></table></div>
<p>In the example HIV model provided, there are five possible values for
<em>infection</em>:</p>
<ul class="simple">
<li>0 = uninfected</li>
<li>1 = virally suppressed (usually on treatment)</li>
<li>2 = primary infection (highly infectious)</li>
<li>3 = chronic infection (usually lasts several years)</li>
<li>4 = Final stage (AIDS)</li>
</ul>
<p>Let’s start with the header (line 1). The last column is <em>4|4</em>. The first “4” is
simply the name of the column (representing stage 4 infection), and could have
been called anything. But the “4” after the pipe (|) tells FastSTI that the last
four columns all represent probabilities. If a dataset contains more than one
probability column then this must be specified. FastSTI then knows that the
first three fields, <em>sex</em>, <em>sex_preferred</em> and <em>age</em> are not probability
columns, and correspond precisely to the names of fields in the fsti_agent data
structure. If they didn’t, FastSTI would terminate with an error.</p>
<p>The dataset needs an entry (or row) for each combination of sex, sex_preferred
and age. Also the first row of every dataset after the header must start with
every property set to 0, and then cycle incrementally through all combinations
of possible values for the properties. This may sound tiresome, but it ensures
that probabilities can be looked up using a random access search, rather than
having to sequentially search the table.</p>
<p>There is one important short-cut. Notice the column headed “age|10-YEAR”. The
pipe followed by either an integer or a time period, tells FastSTI to divide the
agent’s age by this number, in this case 10 years, in order to get the value to
search for in the dataset. So an agent with age 45 will have its age divided by
10 which gives it a lookup value for its age of 4 (the .5 is dropped - this is
integer division).</p>
<p>What about an agent whose age is 60 or more (because the ages run from 0 to 5)? The
dataset lookup algorithm assumes any agent property greater than the largest
value is equal to the largest value.</p>
<p>Consider an agent who is male, prefers to have sex with females and is 31 years
old. What is the probability they are HIV-positive (in this dataset)? And if
HIV-positive, what infection stage is he likely to be in?</p>
<p>The agent matches line 11, which corresponds to male agents (first column with a
value of 0) whose preferred sexual partner is female (second column with a value
of 1) and agents aged 30 to 39 (third column with a value of 3, i.e. 31 / 3).</p>
<p>To determine if the agent is infected with HIV, the <em>_generate_agents</em> event
samples a uniform random number, <em>r</em>.</p>
<ul class="simple">
<li>If <em>r</em> is less than 0.05 (the value in column 4 of line 11), the agent is in stage 1.</li>
<li>If <em>r</em> is less than 0.1 (the value in column 5 of line 11), the agent is in stage 2.</li>
<li>If <em>r</em> is less than 0.15 (the value in column 6 of line 11) the agent is in
stage 3.</li>
<li>If <em>r</em> is less than 0.2 (the value in column 7 of line 11) the agent is in
stage 4.</li>
<li>Else if <em>r</em> is greater than or equal to 0.2, the agent is uninfected.</li>
</ul>
<p>With most events, the agent characteristics you use are up to you. You could
create a dataset for generating the initial infection status of agents that
doesn’t take into account <em>sex_preferred</em> or <em>age</em>. Alternately, you could add a
<em>coinfection</em> column (because there is a field called coinfection in the FastSTI
agent structure), and make the infection probabilities dependent on that.</p>
<p>There is somewhat less flexibility with the probability fields. These are
event-specific. As it happens the code that sets the infection stage expects one
or more user-defined stages, so you can specify fewer or more than the four
stages in the above example.</p>
<div class="section" id="two-agent-datasets">
<h4>Two-agent datasets<a class="headerlink" href="#two-agent-datasets" title="Permalink to this headline">¶</a></h4>
<p>Some events need to make a decision based on two agents. In modelling sexually
transmitted infections, the most obvious example is an event that determines if
an agent becomes infected. FastSTI’s supplied <em>_infect</em> event does just this. It
iterates over all pairs of agents in sero-discordant sexual relationships, and
determines whether the negative partners becomes infected.</p>
<p>Consider two agents, <em>a</em> and <em>b</em>. One, <em>a</em>, is uninfected, and the other <em>b</em> is
infected. If we want the risk of infection to be determined by <em>a</em>’s sex and
whether it is in a same-sex or opposite-sex relationship with <em>b</em> then we need
some way of specifying this in a dataset. Also, we are interested in what
infection stage <em>b</em> is in. If <em>b</em> is on treatment, for example, the risk of
infecting <em>a</em> may be very low.</p>
<p>The dataset_infect.csv dataset shows how this is handled in FastSTI.</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   sex;sex|1|~;infected;probability
   0;0;0;0
   0;0;1;0
   0;0;2;0.02
   0;0;3;0.008
   0;0;4;0.008
   0;1;0;0
   0;1;1;0
   0;1;2;0.01
   0;1;3;0.004
   0;1;4;0.004
   1;0;0;0
   1;0;1;0
   1;0;2;0.012
   1;0;3;0.005
   1;0;4;0.005
   1;1;0;0
   1;1;1;0
   1;1;2;0.0001
   1;1;3;0.0001
   1;1;4;0.0001
</pre></div>
</td></tr></table></div>
<p>The header (line 1) contains two columns named <em>sex</em>. The first one corresponds
to the uninfected agent, <em>a</em>. The second and third columns are the sex and
infection stage of <em>b</em>. How does FastSTI know this? Look at the second column
heading: <em>sex|1|~</em>.  The first pipe (|) is used to separate sex from the amount the
property must be divided by. Well, unlike age, we don’t want the sex to be more
granular, so we specify it as 1. The second pipe is followed by a tilde
(~). The tilde in the column header tells FastSTI that this is a two-agent
lookup table and the second agent’s properties start in this column. So the
second and third columns belong to agent <em>b</em>. The final column, with name
<em>probability</em>, is simply the probability of becoming infected. (By default events
are executed daily, so the probability must correspond to this time-step.)</p>
<p>So if agent <em>a</em> is a female, and agent <em>b</em> is male in stage 2 (primary
infection), what is the risk of <em>a</em> becoming infected on this iteration of the
<em>_infect</em> event? The answer is given by line 14: 0.012.</p>
</div>
</div>
<div class="section" id="agents">
<h3>Agents<a class="headerlink" href="#agents" title="Permalink to this headline">¶</a></h3>
<p>Instead of generating agents, you can provide an agent file as input to the
simulation. In fact, since the agent generation features of FastSTI are
currently quite limited, you’ll probably prefer to supply an agent file.</p>
<p>The agents must be specified in a CSV file. The column names in the header row
must correspond to one or more field names in FastSTI’s agent structure, which is declared
as <em>struct fsti_agent</em> in the source file <em>src/fsti-agent.h</em>. The fields are:</p>
<ul class="simple">
<li>id: unsigned 32 bit integer, unique for each agent (If you do not include this
field, FastSTI automatically provides this value for each agent, starting from
0.)</li>
<li>sex: unsigned 8 bit integer (0 is male, 1 is female. Higher values are user-defined.)</li>
<li>Either sex_preferred or orientation, an unsigned 8 bit integer (Do not use
both fields. We recommend using sex_preferred rather than orientation. For
sex_preferred 0 is male, 1 is female. For orientation either use 0 and 1 for
heterosexual and homosexual respectively, or 0, 1, 2 and 3 for MSM, MSW, WSM
and WSW respectively. Higher values are user-defined.)</li>
<li>age: a positive year age of an agent between 0 and 120.</li>
<li>birthday: a signed 32 bit integer (Unless you understand the internal workings
of FastSTI very well, we recommend you rather use age)</li>
<li>infected: unsigned 8 bit integer (0 is uninfected. 1 and up can correspond to
stages of infection.)</li>
<li>treated: unsigned 8 bit integer (0 is untreated. 1 and up can correspond to
treatment regimens.)</li>
<li>resistant: unsigned 8 bit integer (0 is no resistance. You can either use a
simple approach to resistance, whereby 1 means resistant to treatment regimen
1, 2 to treatment regimen 2 etc, or you can use a more complex binary bitmask
approach where 1 denotes resistance to regimen 1 only, 10, denotes resistance
to regimen 2, 11 denotes resistance to regimen 1 and 2 etc.)</li>
<li>coinfected (0 means not coinfected. 1 and up denotes different types of
coinfection as chosen by the user. Once again, as with the resistant field,
either a simple or bitmask approach can be used.)</li>
<li>partners_0, partners_1, and partners_2: unsigned 32 bit integers denoting the
id of a sexual partner of this agent (-1 implies agent is single. The agents
are typically numbered from 0. Note: None of the default FastSTI events
currently caters for concurrency. Only use partners_1 and partners_2 if you
are implementing events that rely on partner concurrency. If you need more
partners, change the value of FSTI_MAX_PARTNERS in fsti_userdefs.h.)</li>
<li>relchange_0, relchange_1, and relchange_2: unsigned 32 bit integers
corresponding to the iteration (i.e. time step) in the simulation when the
agent’s relationship status for partner_0, partner_1 and partner_2
respectively should change, either to single for agents with partners or to be
placed in the mating pool if the agent is single</li>
</ul>
<p>Here is an example CSV file. The default delimiter is a semi-colon, not a comma. You
can change this by setting the csv_delimiter.</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   id;age;infected;sex;sex_preferred;partners_0
   0;45.21;0;1;0;-1
   1;47.35;1;0;1;0
   2;36.62;0;1;0;-1
   3;35.40;0;1;0;-1
   4;24.25;0;0;1;-1
   5;24.12;0;0;1;4
   6;23.26;0;0;1;-1
   7;45.17;0;0;1;-1
   8;34.81;0;0;1;-1
   9;35.80;0;0;1;8
</pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="output-file-formats">
<h2>Output file formats<a class="headerlink" href="#output-file-formats" title="Permalink to this headline">¶</a></h2>
<div class="section" id="results-reports">
<h3>Results reports<a class="headerlink" href="#results-reports" title="Permalink to this headline">¶</a></h3>
<p>Whenever the <em>_report</em> is executed, it writes output in CSV format either to the
standard output device (default) or an output file as specified by the
<em>results_file</em> key in the configuration. This output is meant to be
post-processed by you either in a spreadsheet, or using a scripting language
like R or Python.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><strong>(advanced use)</strong> The <em>_report</em> event prints out quite basic
information. You can enhance it in the fsti_userdefs.h file by defining the
<em>FSTI_HOOK_REPORT</em> macro. See the <em>FSTI_REPORT</em> macro in fsti-defaults.h.</p>
</div>
<p>Here is an example output from a set of simulations:</p>
<div class="highlight-none notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145</pre></div></td><td class="code"><div class="highlight"><pre><span></span>   name;sim;num;date;description;value
   Simulation_0;0;0;2018-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_0;0;0;2018-01-01;MAX_AGE_ALIVE;49.000000
   Simulation_0;0;0;2018-01-01;MEAN_AGE_ALIVE;23.000000
   Simulation_0;0;0;2018-01-01;MEDIAN_AGE_ALIVE;18.000000
   Simulation_0;0;0;2018-01-01;INFECT_RATE_ALIVE;0.077900
   Simulation_0;0;0;2018-01-01;POP_ALIVE;20000
   Simulation_0;0;0;2018-01-01;NUM_PARTNERS;3573
   Simulation_0;0;0;2018-01-01;MIN_AGE_DEAD;nan
   Simulation_0;0;0;2018-01-01;MAX_AGE_DEAD;nan
   Simulation_0;0;0;2018-01-01;MEAN_AGE_DEAD;nan
   Simulation_0;0;0;2018-01-01;INFECT_RATE_DEAD;-nan
   Simulation_0;0;0;2018-01-01;POP_DEAD;0
   Simulation_0;0;0;2018-01-01;INITIAL_INFECTIONS;1558
   Simulation_0;0;0;2018-01-01;SIMULATION_INFECTIONS;0
   Simulation_0;0;0;2018-01-01;INITIAL_MATCHES;3573
   Simulation_0;0;0;2018-01-01;SIMULATION_MATCHES;0
   Simulation_0;0;0;2018-01-01;BREAKUPS;0
   Simulation_0;0;0;2018-01-01;TIME_TAKEN;1
   Simulation_0;0;0;2028-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_0;0;0;2028-01-01;MAX_AGE_ALIVE;59.000000
   Simulation_0;0;0;2028-01-01;MEAN_AGE_ALIVE;30.000000
   Simulation_0;0;0;2028-01-01;MEDIAN_AGE_ALIVE;26.000000
   Simulation_0;0;0;2028-01-01;INFECT_RATE_ALIVE;0.142421
   Simulation_0;0;0;2028-01-01;POP_ALIVE;23592
   Simulation_0;0;0;2028-01-01;NUM_PARTNERS;8442
   Simulation_0;0;0;2028-01-01;MIN_AGE_DEAD;15.000000
   Simulation_0;0;0;2028-01-01;MAX_AGE_DEAD;58.000000
   Simulation_0;0;0;2028-01-01;MEAN_AGE_DEAD;31.000000
   Simulation_0;0;0;2028-01-01;INFECT_RATE_DEAD;0.738192
   Simulation_0;0;0;2028-01-01;POP_DEAD;741
   Simulation_0;0;0;2028-01-01;INITIAL_INFECTIONS;1558
   Simulation_0;0;0;2028-01-01;SIMULATION_INFECTIONS;2349
   Simulation_0;0;0;2028-01-01;INITIAL_MATCHES;3573
   Simulation_0;0;0;2028-01-01;SIMULATION_MATCHES;145574
   Simulation_0;0;0;2028-01-01;BREAKUPS;140193
   Simulation_0;0;0;2028-01-01;TIME_TAKEN;6
   Simulation_0;1;1;2018-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_0;1;1;2018-01-01;MAX_AGE_ALIVE;49.000000
   Simulation_0;1;1;2018-01-01;MEAN_AGE_ALIVE;23.000000
   Simulation_0;1;1;2018-01-01;MEDIAN_AGE_ALIVE;18.000000
   Simulation_0;1;1;2018-01-01;INFECT_RATE_ALIVE;0.080300
   Simulation_0;1;1;2018-01-01;POP_ALIVE;20000
   Simulation_0;1;1;2018-01-01;NUM_PARTNERS;3601
   Simulation_0;1;1;2018-01-01;MIN_AGE_DEAD;nan
   Simulation_0;1;1;2018-01-01;MAX_AGE_DEAD;nan
   Simulation_0;1;1;2018-01-01;MEAN_AGE_DEAD;nan
   Simulation_0;1;1;2018-01-01;INFECT_RATE_DEAD;-nan
   Simulation_0;1;1;2018-01-01;POP_DEAD;0
   Simulation_0;1;1;2018-01-01;INITIAL_INFECTIONS;1606
   Simulation_0;1;1;2018-01-01;SIMULATION_INFECTIONS;0
   Simulation_0;1;1;2018-01-01;INITIAL_MATCHES;3601
   Simulation_0;1;1;2018-01-01;SIMULATION_MATCHES;0
   Simulation_0;1;1;2018-01-01;BREAKUPS;0
   Simulation_0;1;1;2018-01-01;TIME_TAKEN;6
   Simulation_0;1;1;2028-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_0;1;1;2028-01-01;MAX_AGE_ALIVE;59.000000
   Simulation_0;1;1;2028-01-01;MEAN_AGE_ALIVE;30.000000
   Simulation_0;1;1;2028-01-01;MEDIAN_AGE_ALIVE;26.000000
   Simulation_0;1;1;2028-01-01;INFECT_RATE_ALIVE;0.142754
   Simulation_0;1;1;2028-01-01;POP_ALIVE;23516
   Simulation_0;1;1;2028-01-01;NUM_PARTNERS;8432
   Simulation_0;1;1;2028-01-01;MIN_AGE_DEAD;15.000000
   Simulation_0;1;1;2028-01-01;MAX_AGE_DEAD;55.000000
   Simulation_0;1;1;2028-01-01;MEAN_AGE_DEAD;31.000000
   Simulation_0;1;1;2028-01-01;INFECT_RATE_DEAD;0.768553
   Simulation_0;1;1;2028-01-01;POP_DEAD;795
   Simulation_0;1;1;2028-01-01;INITIAL_INFECTIONS;1606
   Simulation_0;1;1;2028-01-01;SIMULATION_INFECTIONS;2362
   Simulation_0;1;1;2028-01-01;INITIAL_MATCHES;3601
   Simulation_0;1;1;2028-01-01;SIMULATION_MATCHES;146416
   Simulation_0;1;1;2028-01-01;BREAKUPS;141010
   Simulation_0;1;1;2028-01-01;TIME_TAKEN;11
   Simulation_1;2;0;2018-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_1;2;0;2018-01-01;MAX_AGE_ALIVE;49.000000
   Simulation_1;2;0;2018-01-01;MEAN_AGE_ALIVE;23.000000
   Simulation_1;2;0;2018-01-01;MEDIAN_AGE_ALIVE;18.000000
   Simulation_1;2;0;2018-01-01;INFECT_RATE_ALIVE;0.080600
   Simulation_1;2;0;2018-01-01;POP_ALIVE;20000
   Simulation_1;2;0;2018-01-01;NUM_PARTNERS;3569
   Simulation_1;2;0;2018-01-01;MIN_AGE_DEAD;nan
   Simulation_1;2;0;2018-01-01;MAX_AGE_DEAD;nan
   Simulation_1;2;0;2018-01-01;MEAN_AGE_DEAD;nan
   Simulation_1;2;0;2018-01-01;INFECT_RATE_DEAD;-nan
   Simulation_1;2;0;2018-01-01;POP_DEAD;0
   Simulation_1;2;0;2018-01-01;INITIAL_INFECTIONS;1612
   Simulation_1;2;0;2018-01-01;SIMULATION_INFECTIONS;0
   Simulation_1;2;0;2018-01-01;INITIAL_MATCHES;3569
   Simulation_1;2;0;2018-01-01;SIMULATION_MATCHES;0
   Simulation_1;2;0;2018-01-01;BREAKUPS;0
   Simulation_1;2;0;2018-01-01;TIME_TAKEN;5
   Simulation_1;2;0;2028-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_1;2;0;2028-01-01;MAX_AGE_ALIVE;59.000000
   Simulation_1;2;0;2028-01-01;MEAN_AGE_ALIVE;30.000000
   Simulation_1;2;0;2028-01-01;MEDIAN_AGE_ALIVE;26.000000
   Simulation_1;2;0;2028-01-01;INFECT_RATE_ALIVE;0.136983
   Simulation_1;2;0;2028-01-01;POP_ALIVE;23638
   Simulation_1;2;0;2028-01-01;NUM_PARTNERS;8423
   Simulation_1;2;0;2028-01-01;MIN_AGE_DEAD;15.000000
   Simulation_1;2;0;2028-01-01;MAX_AGE_DEAD;59.000000
   Simulation_1;2;0;2028-01-01;MEAN_AGE_DEAD;32.000000
   Simulation_1;2;0;2028-01-01;INFECT_RATE_DEAD;0.717507
   Simulation_1;2;0;2028-01-01;POP_DEAD;754
   Simulation_1;2;0;2028-01-01;INITIAL_INFECTIONS;1612
   Simulation_1;2;0;2028-01-01;SIMULATION_INFECTIONS;2167
   Simulation_1;2;0;2028-01-01;INITIAL_MATCHES;3569
   Simulation_1;2;0;2028-01-01;SIMULATION_MATCHES;145976
   Simulation_1;2;0;2028-01-01;BREAKUPS;140568
   Simulation_1;2;0;2028-01-01;TIME_TAKEN;10
   Simulation_1;3;1;2018-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_1;3;1;2018-01-01;MAX_AGE_ALIVE;49.000000
   Simulation_1;3;1;2018-01-01;MEAN_AGE_ALIVE;23.000000
   Simulation_1;3;1;2018-01-01;MEDIAN_AGE_ALIVE;18.000000
   Simulation_1;3;1;2018-01-01;INFECT_RATE_ALIVE;0.083850
   Simulation_1;3;1;2018-01-01;POP_ALIVE;20000
   Simulation_1;3;1;2018-01-01;NUM_PARTNERS;3550
   Simulation_1;3;1;2018-01-01;MIN_AGE_DEAD;nan
   Simulation_1;3;1;2018-01-01;MAX_AGE_DEAD;nan
   Simulation_1;3;1;2018-01-01;MEAN_AGE_DEAD;nan
   Simulation_1;3;1;2018-01-01;INFECT_RATE_DEAD;-nan
   Simulation_1;3;1;2018-01-01;POP_DEAD;0
   Simulation_1;3;1;2018-01-01;INITIAL_INFECTIONS;1677
   Simulation_1;3;1;2018-01-01;SIMULATION_INFECTIONS;0
   Simulation_1;3;1;2018-01-01;INITIAL_MATCHES;3550
   Simulation_1;3;1;2018-01-01;SIMULATION_MATCHES;0
   Simulation_1;3;1;2018-01-01;BREAKUPS;0
   Simulation_1;3;1;2018-01-01;TIME_TAKEN;5
   Simulation_1;3;1;2028-01-01;MIN_AGE_ALIVE;15.000000
   Simulation_1;3;1;2028-01-01;MAX_AGE_ALIVE;59.000000
   Simulation_1;3;1;2028-01-01;MEAN_AGE_ALIVE;30.000000
   Simulation_1;3;1;2028-01-01;MEDIAN_AGE_ALIVE;26.000000
   Simulation_1;3;1;2028-01-01;INFECT_RATE_ALIVE;0.139352
   Simulation_1;3;1;2028-01-01;POP_ALIVE;23595
   Simulation_1;3;1;2028-01-01;NUM_PARTNERS;8456
   Simulation_1;3;1;2028-01-01;MIN_AGE_DEAD;15.000000
   Simulation_1;3;1;2028-01-01;MAX_AGE_DEAD;58.000000
   Simulation_1;3;1;2028-01-01;MEAN_AGE_DEAD;31.000000
   Simulation_1;3;1;2028-01-01;INFECT_RATE_DEAD;0.728205
   Simulation_1;3;1;2028-01-01;POP_DEAD;780
   Simulation_1;3;1;2028-01-01;INITIAL_INFECTIONS;1677
   Simulation_1;3;1;2028-01-01;SIMULATION_INFECTIONS;2179
   Simulation_1;3;1;2028-01-01;INITIAL_MATCHES;3550
   Simulation_1;3;1;2028-01-01;SIMULATION_MATCHES;146061
   Simulation_1;3;1;2028-01-01;BREAKUPS;140609
   Simulation_1;3;1;2028-01-01;TIME_TAKEN;10
</pre></div>
</td></tr></table></div>
<ul class="simple">
<li>The first column (name) is the simulation group name as specified in the configuration
file.</li>
<li>The second column (sim) is the unique simulation number. In every execution of
FastSTI, each simulation will have its own unique id, starting from 0.</li>
<li>The third column (num) is the number of the simulation within the simulation
group. Here each of the two simulation groups (Simulation_0 and Simulation_1)
executed two simulations each, numbered 0 and 1.</li>
<li>The fourth column is the date within the simulation that this snapshot report
is for. In these simulations, the start date was 1 January 2018, and the end
date was 1 January 2028. The <em>_report</em> event ran before and after the
simulation (it can run as often as you like during the simulation as well).</li>
<li>The fifth column is the description of what’s being reported. These should be
self-explanatory.</li>
<li>The sixth column is the value of what’s being reported. E.g. 10 for TIME_TAKEN
means the simulation ran in 10 seconds up to that point.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The output in the example above is all in chronological order. This is
because it was a single-threaded sequential execution. Normally you will do a
multithreaded execution and the report lines will likely <strong>not</strong> come out in
order. When analysing them in a spreadsheet, R or Python, remember to sort
the output by the first four columns.</p>
</div>
</div>
<div class="section" id="id1">
<h3>Agents<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>To do</p>
</div>
</div>
<div class="section" id="parameters">
<span id="parameter-ref"></span><h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p>To do</p>
</div>
<div class="section" id="events">
<span id="event-ref"></span><h2>Events<a class="headerlink" href="#events" title="Permalink to this headline">¶</a></h2>
<p>To do</p>
</div>
<div class="section" id="extending-faststi">
<h2>Extending FastSTI<a class="headerlink" href="#extending-faststi" title="Permalink to this headline">¶</a></h2>
<p>To do (Example: Syphilis simulation)</p>
</div>
<div class="section" id="help-improve-faststi">
<h2>Help improve FastSTI<a class="headerlink" href="#help-improve-faststi" title="Permalink to this headline">¶</a></h2>
<p>We appreciate help with FastSTI, both with coding and documentation. Here are
some things that need to be done:</p>
<ul class="simple">
<li>Built-in calibration: At present if you want to calibrate a FastSTI model,
you’d best use R or Python to process agent output files from FastSTI, and generate .ini
configuration files as input back into FastSTI with new parameters. We think
it would probably be better if FastSTI’s configuration could be enhanced to
calibrate the model.</li>
<li>Concurrent relationships: Although the fsti_agent data structure supports
concurrent relationships, none of the events are currently designed to handle
meaningfully concurrent relationships.</li>
<li>More events: Code variations on the current events and new events.</li>
<li>Build Python and R interfaces to FastSTI.</li>
<li>Improve this documentation.</li>
</ul>
<p>Feel free to clone the Github repository and submit patches. But before doing
so, it may be best to email <a class="reference external" href="mailto:nathangeffen&#37;&#52;&#48;gmail&#46;com">nathangeffen<span>&#64;</span>gmail<span>&#46;</span>com</a> to inform us what you
would like to do, so we can discuss the best way to proceed.</p>
</div>
<div class="section" id="bugs-and-other-issues">
<h2>Bugs and other issues<a class="headerlink" href="#bugs-and-other-issues" title="Permalink to this headline">¶</a></h2>
<p>Please lodge bugs, requests for enhancements, etc at the FastSTI <a class="reference external" href="https://github.com/nathangeffen/faststi/issues">Github
repository  issues page</a>.</p>
</div>
<div class="section" id="credits">
<h2>Credits<a class="headerlink" href="#credits" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Nathan Geffen designed and implemented FastSTI.</li>
<li>Stefan Scholz coded the syphilis model with Nathan.</li>
<li>Eduard Grebe wrote the macOS installation instructions.</li>
</ul>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="#">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">FastSTI: Simulations of sexually transmitted infections</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#installation">Installation</a><ul>
<li><a class="reference internal" href="#gnu-linux">GNU/Linux</a></li>
<li><a class="reference internal" href="#apple-macos">Apple macOS</a></li>
<li><a class="reference internal" href="#windows">Windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-that-it-works">Testing that it works</a></li>
<li><a class="reference internal" href="#how-to-use-faststi">How to use FastSTI</a><ul>
<li><a class="reference internal" href="#simulations">Simulations</a></li>
<li><a class="reference internal" href="#example">Example</a><ul>
<li><a class="reference internal" href="#a-full-simulation">A full simulation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#input-file-formats">Input file formats</a><ul>
<li><a class="reference internal" href="#configuration">Configuration</a></li>
<li><a class="reference internal" href="#datasets">Datasets</a><ul>
<li><a class="reference internal" href="#two-agent-datasets">Two-agent datasets</a></li>
</ul>
</li>
<li><a class="reference internal" href="#agents">Agents</a></li>
</ul>
</li>
<li><a class="reference internal" href="#output-file-formats">Output file formats</a><ul>
<li><a class="reference internal" href="#results-reports">Results reports</a></li>
<li><a class="reference internal" href="#id1">Agents</a></li>
</ul>
</li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#events">Events</a></li>
<li><a class="reference internal" href="#extending-faststi">Extending FastSTI</a></li>
<li><a class="reference internal" href="#help-improve-faststi">Help improve FastSTI</a></li>
<li><a class="reference internal" href="#bugs-and-other-issues">Bugs and other issues</a></li>
<li><a class="reference internal" href="#credits">Credits</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="#">FastSTI 0.1.0 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Nathan Geffen and Stefan Scholz.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>